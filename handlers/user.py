from aiogram import Dispatcher, F, types
from keyboards.inline import get_topics_keyboard # –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É
from services.openai_service import generate_response  # –°–µ—Ä–≤–∏—Å –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–æ–≤ —Å –ø–æ–º–æ—â—å—é OpenAI


# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–π
async def handle_greeting(message: types.Message):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–π"""
    # –û—Ç–≤–µ—á–∞–µ–º –Ω–∞ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    await message.answer("–ü—Ä–∏–≤–µ—Ç! –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Startup House! üöÄ")


# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤, —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å –ò–ò
async def handle_ai_keywords(message: types.Message):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤, —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å –ò–ò"""
    # –û—Ç–≤–µ—á–∞–µ–º –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è, —Å–æ–¥–µ—Ä–∂–∞—â–∏–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –ø–æ —Ç–µ–º–µ –ò–ò
    await message.answer("–ò–Ω—Ç–µ—Ä–µ—Å–Ω–∞—è —Ç–µ–º–∞! –†–∞—Å—Å–∫–∞–∂–∏, –∫–∞–∫ —Ç—ã –∏—Å–ø–æ–ª—å–∑—É–µ—à—å –ò–ò –≤ –±–∏–∑–Ω–µ—Å–µ? üí°")


# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤, —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å –±–∏–∑–Ω–µ—Å–æ–º
async def handle_business_keywords(message: types.Message):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤, —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å –±–∏–∑–Ω–µ—Å–æ–º"""
    # –û—Ç–≤–µ—á–∞–µ–º –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è, —Å–æ–¥–µ—Ä–∂–∞—â–∏–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –ø–æ —Ç–µ–º–µ –±–∏–∑–Ω–µ—Å–∞
    await message.answer("–ë–∏–∑–Ω–µ—Å –∏ —Å—Ç–∞—Ä—Ç–∞–ø—ã - –∑–∞—Ö–≤–∞—Ç—ã–≤–∞—é—â–∞—è —Ç–µ–º–∞! –ß—Ç–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ —Ç–µ–±—è –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç? üíº",
                         reply_markup=get_topics_keyboard())


# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –ø—Ä–æ—á–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (–±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å OpenAI API)
async def handle_other_messages(message: types.Message):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –ø—Ä–æ—á–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π"""
    # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç —Å –ø–æ–º–æ—â—å—é OpenAI API –¥–ª—è –≤—Å–µ—Ö –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
    response = await generate_response(message.text)
    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
    await message.answer(response)


def register_user_handlers(dp: Dispatcher):
    """–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    # –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è - –∏—Å–ø–æ–ª—å–∑—É–µ–º F.text.contains –≤–º–µ—Å—Ç–æ Text –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞–ª–∏—á–∏—è –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤
    # | - –æ–ø–µ—Ä–∞—Ç–æ—Ä –ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ "–ò–õ–ò" –¥–ª—è –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤
    dp.message.register(
        handle_greeting, 
        F.text.lower().contains("–ø—Ä–∏–≤–µ—Ç") | 
        F.text.lower().contains("–∑–¥—Ä–∞–≤—Å—Ç–≤—É–π") | 
        F.text.lower().contains("—Ö–∞–π") | 
        F.text.lower().contains("hello") | 
        F.text.lower().contains("hi")
    )
    
    # –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –ò–ò - —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π, 
    # —Å–æ–¥–µ—Ä–∂–∞—â–∏—Ö —Å–ª–æ–≤–∞ –∏–∑ –æ–±–ª–∞—Å—Ç–∏ –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞
    dp.message.register(
        handle_ai_keywords,
        F.text.lower().contains("–∏–∏") | 
        F.text.lower().contains("–∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç") | 
        F.text.lower().contains("ai") | 
        F.text.lower().contains("–Ω–µ–π—Ä–æ—Å–µ—Ç—å") | 
        F.text.lower().contains("–Ω–µ–π—Ä–æ–Ω–∫–∞") | 
        F.text.lower().contains("chatgpt") | 
        F.text.lower().contains("gpt")
    )
    
    # –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –±–∏–∑–Ω–µ—Å–æ–º - —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π,
    # —Å–æ–¥–µ—Ä–∂–∞—â–∏—Ö —Å–ª–æ–≤–∞ –∏–∑ –æ–±–ª–∞—Å—Ç–∏ –±–∏–∑–Ω–µ—Å–∞ –∏ –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—å—Å—Ç–≤–∞
    dp.message.register(
        handle_business_keywords,
        F.text.lower().contains("–±–∏–∑–Ω–µ—Å") | 
        F.text.lower().contains("—Å—Ç–∞—Ä—Ç–∞–ø") | 
        F.text.lower().contains("–ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—å—Å—Ç–≤–æ") | 
        F.text.lower().contains("startup") | 
        F.text.lower().contains("business")
    )
    
    # –ü—Ä–æ—á–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è - —ç—Ç–æ—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –≤—Å–µ—Ö –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π,
    # –Ω–µ –ø–æ–ø–∞–≤—à–∏—Ö –ø–æ–¥ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Ñ–∏–ª—å—Ç—Ä—ã
    dp.message.register(handle_other_messages)
